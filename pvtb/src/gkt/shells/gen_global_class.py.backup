#!/usr/bin/env python3
import sys, os
sys.path.append(os.path.dirname(os.path.realpath(__file__)) + '/../test')
sys.path.append(os.path.dirname(os.path.realpath(__file__)) + '/../src')
from gkt_util import *
from global_class import *
# Write ptn into 1
#glb_test_ptn = 'perf_global_(load|store|load_to_lds|atomic)_dwordx(\d+)_hit(\w+)_ipw(\d+)_wpg(\d+)_instoffset(\d+)_inst(f32|f32x4|f64|f64x2|noatomic)'
#inst_arg_str, all_args = GlobalClass.get_args_from_name(glb_test_ptn, INST_ARGS_MEMTYPE, INST_ARGS_DWPI, INST_ARGS_HIT, INST_ARGS_IPW, INST_ARGS_WPG, INST_ARGS_INSTOFF, INST_ARGS_INST)
# Divide ptns
glb_test_ptn = ['perf_global_(load|store|load_to_lds)_dwordx(\d+)_hit(\w+)_ipw(\d+)_wpg(\d+)_instoffset(\d+)',
'perf_global_(atomic)_inst(f32|f32x4|f64|f64x2)_ipw(\d+)_wpg(\d+)']
for ptn in glb_test_ptn:
if 'perf_global_(atomic)_inst' in ptn:
inst_arg_str, all_args = GlobalClass.get_args_from_name(ptn, INST_ARGS_MEMTYPE, INST_ARGS_INST, INST_ARGS_IPW, INST_ARGS_WPG)
else:
inst_arg_str, all_args = GlobalClass.get_args_from_name(ptn, INST_ARGS_MEMTYPE, INST_ARGS_DWPI, INST_ARGS_HIT, INST_ARGS_IPW, INST_ARGS_WPG, INST_ARGS_INSTOFF)

if not inst_arg_str and not all_args:
if ptn == glb_test_ptn[-1:]:
	print(f"no args matched from name")
continue
else:
	print(inst_arg_str)
gltest = GlobalClass(inst_arg_str)
gltest.gen_output()
break



